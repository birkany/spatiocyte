AC_REVISION([$Id$])dnl

dnl Process this file with autoconf to produce a configure script.


AC_INIT
AC_CONFIG_SRCDIR([libecs/Entity.hpp])

AM_CONFIG_HEADER(config.h)

ECELL_MAJOR_VERSION=3
ECELL_MINOR_VERSION=1
ECELL_MICRO_VERSION=96
VERSION=$ECELL_MAJOR_VERSION.$ECELL_MINOR_VERSION.$ECELL_MICRO_VERSION
PACKAGE=ecell
ECELL_VERSION_STRING=$VERSION


AC_DEFINE_UNQUOTED( ECELL_MAJOR_VERSION, ${ECELL_MAJOR_VERSION},[] )
AC_DEFINE_UNQUOTED( ECELL_MINOR_VERSION, ${ECELL_MINOR_VERSION},[] )
AC_DEFINE_UNQUOTED( ECELL_MICRO_VERSION, ${ECELL_MICRO_VERSION},[] )
AC_DEFINE_UNQUOTED( ECELL_VERSION_STRING, "${ECELL_VERSION_STRING}",[] )

AM_INIT_AUTOMAKE($PACKAGE, $VERSION)

AM_SANITY_CHECK

AC_CANONICAL_HOST

if test $prefix = "NONE" ; then
	PREFIX=$ac_default_prefix
else
	PREFIX=$prefix
fi

AC_SUBST(PREFIX)

dnl Checks for programs.

AC_PROG_CC
AC_PROG_CXX
AC_PROG_CPP
AC_PROG_CXXCPP
AC_PROG_INSTALL
AC_PROG_LN_S
AC_PROG_MAKE_SET
AC_PROG_RANLIB

AM_DISABLE_STATIC
dnl AC_LIBLTDL_INSTALLABLE(../libltdl)
AC_LIBLTDL_CONVENIENCE(../libltdl)
AC_SUBST(INCLTDL)
AC_SUBST(LIBLTDL)
AC_LIBTOOL_DLOPEN
AC_PROG_LIBTOOL


rm -f conftest
./libtool --config > conftest
. ./conftest
rm -f conftest
dnl
AC_CACHE_CHECK([which extension is used for shared libraries],
  libltdl_cv_shlibext, [dnl
(
  last=
  for spec in $library_names_spec; do
    last="$spec"
  done
changequote(, )
  echo "$last" | sed 's/\[.*\]//;s/^[^.]*//;s/\$.*$//;s/\.$//' > conftest
changequote([, ])
)
libltdl_cv_shlibext=`cat conftest`
rm -f conftest
])
if test -n "$libltdl_cv_shlibext"; then
  LTDL_SHLIB_EXT=$libltdl_cv_shlibext
  AC_SUBST(LTDL_SHLIB_EXT)
fi



AM_PATH_PYTHON(2.2)
AC_SUBST(PYTHON)

AC_LANG([C++])

dnl Checks for libraries.

dnl assuming libc and libm always present...

AC_CHECK_LIB(m, sin, LIBM="-lm")
AC_SUBST(LIBM)
dnl
AC_CHECK_LIB(c, open, LIBC="-lc")
AC_SUBST(LIBC)
dnl

dnl disable checking dlopen for windows
case ${host_os} in
  *cygwin* | *mingw* | *win32*)
    os_win32=yes
    ;;
  *)
    AC_CHECK_LIB(dl, dlopen, LIBDL="-ldl")
    if test "$LIBDL" = ""; then
      AC_MSG_ERROR([The libdl could not be found.])
    fi
    AC_SUBST(LIBDL) 
    os_win32=no
    ;;
esac
AM_CONDITIONAL(OS_WIN32, test "$os_win32" = "yes")

AC_CHECK_LIB(gslcblas,main)
AC_CHECK_LIB(gsl,main)

AM_CHECK_PYMOD(Numeric,,,[AC_MSG_ERROR([could not find Numeric module])])
AM_CHECK_PYMOD(xml,,,[AC_MSG_ERROR([could not find xml module])])

dnl Checks for header files.

AC_HEADER_DIRENT
AC_HEADER_STDC
AC_CHECK_HEADERS(fcntl.h unistd.h)
dnl
dnl stl
dnl
dnl AC_CHECK_HEADER(stl.h,,
dnl 	AC_MSG_ERROR([stl.h not found.])
dnl )
AC_CHECK_HEADERS(math,,)
AC_CHECK_HEADERS(cmath,,)
dnl
dnl
EXT_GUESS="../../../.. ../../.. ../.. ../ ./ $prefix /usr /usr/local /opt"
dnl
dnl
dnl dmtool package
dnl
if test "$DMTOOL_DIR" = "" ; then
        AC_MSG_CHECKING( for dmtool dir)
        ac_cv_dmtool_dir="no"
        for ac_dir in $EXT_GUESS ; do
                if test -d $ac_dir/dmtool ; then
                        ac_cv_dmtool_dir=`(cd $ac_dir ; pwd)`
			DMTOOL_DIR=$ac_cv_dmtool_dir
                fi
        done

	if test "$DMTOOL_DIR" = "" ; then	
		AC_MSG_ERROR("dmtool not found.")
	fi

        AC_MSG_RESULT($ac_cv_dmtool_dir)
        DMTOOL_DIR=$ac_cv_dmtool_dir
        DMTOOL_INCLUDE_DIR=$ac_cv_dmtool_dir
fi
AC_SUBST(DMTOOL_DIR)
AC_SUBST(DMTOOL_INCLUDE_DIR)

dnl
dnl
dnl boost package
dnl
dnl
AC_ARG_WITH( boost-include-dir,,
  [$BOOST_INCLUDE="-I$withval"],
  [$BOOST_INCLUDE=])
AC_SUBST(BOOST_INCLUDE)
AC_ARG_WITH( boost-lib-dir,,
  [$BOOST_LIB="-L$withval"],
  [$BOOST_LIB=])
AC_SUBST(BOOST_LIB)

dnl if test "$BOOST_DIR" = "" ; then
dnl        AC_MSG_CHECKING( for boost dir )
dnl        ac_cv_boost_dir="no"	
dnl        for ac_dir in $EXT_GUESS ; do
dnl                if test -d $ac_dir/boost ; then
dnl                        ac_cv_boost_dir=`(cd $ac_dir/boost ; pwd)`
dnl			BOOST_DIR=$ac_cv_boost_dir
dnl                fi
dnl        done
dnl
dnl	if test "$BOOST_DIR" = "" ; then	
dnl		AC_MSG_ERROR("boost not found.")
dnl	fi
dnl
dnl        AC_MSG_RESULT($ac_cv_boost_dir)
dnl #        BOOST_DIR=$ac_cv_boost_dir
dnl fi
dnl AC_SUBST(BOOST_DIR)

AM_CHECK_PYTHON_HEADERS(,[AC_MSG_ERROR([])])

AC_LANG_PUSH([C])

AC_C_CONST
AC_C_INLINE
if test "$ac_cv_c_inline" != no ; then
  AC_DEFINE([HAVE_INLINE],1,[define if inline is supported])
  AC_SUBST(HAVE_INLINE)
fi

AC_TYPE_OFF_T
AC_TYPE_SIZE_T
AC_TYPE_SIGNAL
AC_C_LONG_DOUBLE
AC_LANG_POP([])

AC_CHECK_SIZEOF(int)
AC_CHECK_SIZEOF(long)
AC_CHECK_SIZEOF(long long)
AC_CHECK_SIZEOF(double)
AC_CHECK_SIZEOF(long double)


dnl ICE_CXX_EXPLICIT
dnl ICE_CXX_MUTABLE
dnl ICE_CXX_NAMESPACE
dnl ICE_CXX_PRETTY_FUNCTION
dnl ICE_CXX_STD_EXCEPTIONS
dnl ICE_CXX_TYPEINFO

dnl Checks for library functions.
AC_TYPE_SIGNAL
dnl AC_FUNC_VPRINTF
AC_CHECK_FUNCS(mkdir select strdup strerror strtod uname modf modfl)
AC_CHECK_FUNCS(strdup strstr)

AC_CONFIG_FILES([Makefile 
libecs/Makefile
libemc/Makefile
pyecs/Makefile
pyecs/ecell3-python
pyecell/Makefile
pyecell/ecell/Makefile
dm/Makefile
pyecell/ecell/gui_config.py
])
AC_CONFIG_COMMANDS([default],[[chmod +x pyecs/ecell3-python
]],[[]])
AC_OUTPUT

