AC_REVISION([$Id$])dnl

dnl Process this file with autoconf to produce a configure script.


dnl VERSION=\"3.0.0\"
dnl PACKAGE=\"ecell\"

dnl AC_SUBST(VERSION)
dnl AC_SUBST(PACKAGE)

AC_INIT
AC_CONFIG_SRCDIR([libecs/Entity.hpp])
AM_INIT_AUTOMAKE(ecell,3.1.2)

AM_SANITY_CHECK

AC_CANONICAL_HOST

if test $prefix = "NONE" ; then
	PREFIX=$ac_default_prefix
else
	PREFIX=$prefix
fi

AC_SUBST(PREFIX)

dnl Checks for programs.

AC_PROG_CC
AC_PROG_CXX
AC_PROG_CPP
AC_PROG_CXXCPP
AC_PROG_INSTALL
AC_PROG_LN_S
AC_PROG_MAKE_SET
AC_PROG_RANLIB

AM_DISABLE_STATIC
AC_LIBLTDL_INSTALLABLE(../libltdl)
AC_SUBST(INCLTDL)
AC_SUBST(LIBLTDL)
AC_LIBTOOL_DLOPEN
AC_PROG_LIBTOOL

AM_PATH_PYTHON(2.2)
AC_SUBST(PYTHON)

AC_LANG([C++])

dnl Checks for libraries.

dnl assuming libc and libm always present...

AC_CHECK_LIB(m, sin, LIBM="-lm")
AC_SUBST(LIBM)
dnl
AC_CHECK_LIB(c, open, LIBC="-lc")
AC_SUBST(LIBC)
dnl

AC_CHECK_LIB(dl, dlopen, LIBDL="-ldl")
if test "$LIBDL" = ""; then
AC_MSG_ERROR([The libdl could not be found.])
fi
AC_SUBST(LIBDL)

AM_CHECK_PYMOD(Numeric,,,[AC_MSG_ERROR([could not find Numeric module])])
AM_CHECK_PYMOD(xml,,,[AC_MSG_ERROR([could not find xml module])])

dnl Checks for header files.

AC_HEADER_DIRENT
AC_HEADER_STDC
AC_CHECK_HEADERS(fcntl.h unistd.h)
dnl
dnl stl
dnl
dnl AC_CHECK_HEADER(stl.h,,
dnl 	AC_MSG_ERROR([stl.h not found.])
dnl )
AC_CHECK_HEADERS(math,,)
AC_CHECK_HEADERS(cmath,,)
dnl
dnl
EXT_GUESS="../../../.. ../../.. ../.. ../ ./ $prefix /usr /usr/local /opt"
dnl
dnl
dnl dmtool package
dnl
if test "$DMTOOL_DIR" = "" ; then
        AC_MSG_CHECKING( for dmtool dir)
        ac_cv_dmtool_dir="no"
        for ac_dir in $EXT_GUESS ; do
                if test -d $ac_dir/dmtool ; then
                        ac_cv_dmtool_dir=`(cd $ac_dir ; pwd)`
			DMTOOL_DIR=$ac_cv_dmtool_dir
                fi
        done

	if test "$DMTOOL_DIR" = "" ; then	
		AC_MSG_ERROR("dmtool not found.")
	fi

        AC_MSG_RESULT($ac_cv_dmtool_dir)
        DMTOOL_DIR=$ac_cv_dmtool_dir
        DMTOOL_INCLUDE_DIR=$ac_cv_dmtool_dir
fi
AC_SUBST(DMTOOL_DIR)
AC_SUBST(DMTOOL_INCLUDE_DIR)

dnl
dnl
dnl boost package
dnl
if test "$BOOST_DIR" = "" ; then
        AC_MSG_CHECKING( for boost dir )
        ac_cv_boost_dir="no"
        for ac_dir in $EXT_GUESS ; do
                if test -d $ac_dir/boost ; then
                        ac_cv_boost_dir=`(cd $ac_dir/boost ; pwd)`
			BOOST_DIR=$ac_cv_boost_dir
                fi
        done

	if test "$BOOST_DIR" = "" ; then	
		AC_MSG_ERROR("boost not found.")
	fi

        AC_MSG_RESULT($ac_cv_boost_dir)
#        BOOST_DIR=$ac_cv_boost_dir
fi
AC_SUBST(BOOST_DIR)

AM_CHECK_PYTHON_HEADERS(,[AC_MSG_ERROR([])])

AC_LANG_PUSH([C])

dnl AC_C_CONST
dnl AC_C_INLINE
AC_TYPE_OFF_T
AC_TYPE_SIZE_T
AC_TYPE_SIGNAL
AC_C_LONG_DOUBLE
AC_LANG_POP([])

AC_CHECK_SIZEOF(int)
AC_CHECK_SIZEOF(long)
AC_CHECK_SIZEOF(long long)

dnl ICE_CXX_PRETTY_FUNCTION
dnl ICE_CXX_STD_EXCEPTIONS
dnl ICE_CXX_TYPEINFO

dnl Checks for library functions.
AC_TYPE_SIGNAL
dnl AC_FUNC_VPRINTF
AC_CHECK_FUNCS(mkdir select strdup strerror strtod uname modf modfl)
AC_CHECK_FUNCS(strdup strstr)

AM_CONFIG_HEADER(config.h)

AC_CONFIG_FILES([Makefile 
libecs/Makefile
libecs/emtool
libecs/dmtemplates/Makefile
libecs/dmtemplates/Process/Makefile
libemc/Makefile
pyecs/Makefile
pyecs/ecell3
pyecell/Makefile
pyecell/ecell/Makefile
])
AC_CONFIG_COMMANDS([default],[[chmod +x pyecs/ecell3 libecs/emtool
]],[[]])
AC_OUTPUT

